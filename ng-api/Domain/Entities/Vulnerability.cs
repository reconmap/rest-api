using System.ComponentModel.DataAnnotations;
using System.ComponentModel.DataAnnotations.Schema;

namespace api_v2.Domain.Entities;

[Table("vulnerability")]
public class Vulnerability : TimestampedEntity
{
    [Key] [Column("id")] public uint Id { get; set; }

    [Column("created_by_uid")] public uint CreatedByUid { get; set; }

    [ForeignKey(nameof(CreatedByUid))] public User? CreatedBy { get; private set; }

    [Required] [Column("is_template")] public bool IsTemplate { get; set; }

    [MaxLength(50)]
    [Column("external_id")]
    public string? ExternalId { get; set; }

    [Column("project_id")] public uint? ProjectId { get; set; }
    [ForeignKey(nameof(ProjectId))] public Project? Project { get; set; }

    [Column("target_id")] public uint? TargetId { get; set; }
    [ForeignKey(nameof(TargetId))] public Asset? Asset { get; set; }


    [Column("category_id")] public uint? CategoryId { get; set; }

    [ForeignKey(nameof(CategoryId))] public VulnerabilityCategory? Category { get; private set; }

    [Required]
    [MaxLength(500)]
    [Column("summary")]
    public string Summary { get; set; } = string.Empty;

    [Column("description", TypeName = "text")]
    public string? Description { get; set; }

    [Column("external_refs", TypeName = "text")]
    public string? ExternalRefs { get; set; }

    [Required] [Column("visibility")] public string? Visibility { get; set; } = "private";

    [Required] [Column("risk")] public string? Risk { get; set; }

    [Column("proof_of_concept", TypeName = "text")]
    public string? ProofOfConcept { get; set; }

    [Column("impact", TypeName = "text")] public string? Impact { get; set; }

    [Column("remediation", TypeName = "text")]
    public string? Remediation { get; set; }

    [Column("remediation_complexity")] public string? RemediationComplexity { get; set; }

    [Column("remediation_priority")] public string? RemediationPriority { get; set; }

    [Column("cvss_score", TypeName = "decimal(3,1)")]
    public decimal? CvssScore { get; set; }

    [MaxLength(80)]
    [Column("cvss_vector")]
    public string? CvssVector { get; set; }

    [Required] [Column("status")] public string Status { get; set; } = "open";

    [Column("substatus")] public string? Substatus { get; set; }

    [Column("tags")] public string? Tags { get; set; }

    [MaxLength(80)]
    [Column("owasp_vector")]
    public string? OwaspVector { get; set; }

    [Column("owasp_likelihood", TypeName = "decimal(5,3)")]
    public decimal? OwaspLikelihood { get; set; }

    [Column("owasp_impact", TypeName = "decimal(5,3)")]
    public decimal? OwaspImpact { get; set; }

    [Column("owasp_overall")] public string? OwaspOverall { get; set; }

    [Column("custom_fields")] public string? CustomFields { get; set; }
}

/*
status	enum('open','confirmed','resolved','closed')	NO		open
substatus	enum('reported','unresolved','unexploited','exploited','remediated','mitigated','rejected')	YES		reported
*/

public enum Risk
{
    none,
    low,
    medium,
    high,
    critical
}

public enum RemediationComplexity
{
    unknown,
    low,
    medium,
    high
}

public enum RemediationPriority
{
    low,
    medium,
    high
}

public enum Substatus
{
    reported,
    unresolved,
    unexploited,
    exploited,
    remediated,
    mitigated,
    rejected
}

public enum OwaspOverall
{
    critical,
    high,
    medium,
    low,
    note
}
