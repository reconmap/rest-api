<?php declare(strict_types=1);

namespace Reconmap\Repositories\Importers;

use Reconmap\Models\VulnerabilityCategory;
use Reconmap\Repositories\VulnerabilityCategoryRepository;

class VulnerabilityCategoriesImporter implements Importable
{
    public function __construct(private readonly VulnerabilityCategoryRepository $vulnerabilityCategoryRepository)
    {
    }

    public function import(int $userId, array $entities): array
    {
        $response = [
            'count' => 0,
            'errors' => [],
        ];

        foreach ($entities as $jsonDoc) {
            try {
                $category = new VulnerabilityCategory();
                $category->name = $jsonDoc->name;
                $category->description = $jsonDoc->description;

                $this->vulnerabilityCategoryRepository->insert($category);

                $response['count']++;
            } catch (\Exception $e) {
                $response['errors'][] = $e->getMessage();
            }
        }

        return $response;
    }
}
